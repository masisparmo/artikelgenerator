<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Artikel SEO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .prose {
            max-width: none;
        }
        .prose h1 {
            font-size: 1.875rem; /* 30px */
            font-weight: 700;
            margin-bottom: 0.5em;
        }
        .prose h2 {
            font-size: 1.5em;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.3em;
        }
        .prose h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin-top: 1.2em;
            margin-bottom: 0.4em;
        }
        .prose p, .prose ul, .prose ol {
            margin-bottom: 1em;
            line-height: 1.6;
        }
        .prose ul, .prose ol {
            padding-left: 1.5em;
        }
        .prose li {
            margin-bottom: 0.5em;
        }
        .prose strong {
            font-weight: 600;
        }
        .prose em {
            font-style: italic;
        }
        .prose a {
            color: #4f46e5;
            text-decoration: none;
        }
        .prose a:hover {
            text-decoration: underline;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Styling for editor toolbar */
        .editor-btn {
            @apply p-2 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-indigo-400;
        }
        #article-output[contenteditable="true"] {
            @apply border-2 border-indigo-300 p-4 rounded-md focus:outline-none;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Generator Artikel SEO Friendly</h1>
            <p class="mt-2 text-gray-600">Buat, edit, dan salin konten berkualitas tinggi yang disukai Google dan pembaca Anda.</p>
        </header>

        <div class="bg-white rounded-lg shadow-lg">
            <!-- Tab Buttons -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex" aria-label="Tabs">
                    <button id="tab-generator" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-indigo-600 border-indigo-500" onclick="switchTab('generator')">
                        Generator Artikel
                    </button>
                    <button id="tab-panduan" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" onclick="switchTab('panduan')">
                        Panduan SEO
                    </button>
                </nav>
            </div>

            <!-- Generator Artikel Tab -->
            <div id="content-generator" class="tab-content active p-6 md:p-8 fade-in">
                <div class="space-y-6">
                    <div>
                        <label for="topic" class="block text-sm font-medium text-gray-700">Topik Artikel</label>
                        <input type="text" id="topic" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Contoh: Manfaat teh hijau untuk kesehatan">
                    </div>
                    <div>
                        <label for="keywords" class="block text-sm font-medium text-gray-700">Kata Kunci (pisahkan dengan koma)</label>
                        <input type="text" id="keywords" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Contoh: teh hijau, antioksidan, kesehatan jantung">
                    </div>

                    <h3 class="text-lg font-medium text-gray-800 border-t pt-6">Sumber Referensi (Opsional)</h3>

                    <div>
                        <label for="url_website" class="block text-sm font-medium text-gray-700">URL Website</label>
                        <input type="url" id="url_website" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="https://contoh-website.com/artikel">
                    </div>

                    <div>
                        <label for="url_youtube" class="block text-sm font-medium text-gray-700">URL YouTube</label>
                        <input type="url" id="url_youtube" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="https://www.youtube.com/watch?v=...">
                    </div>

                    <div>
                         <label for="text_paste" class="block text-sm font-medium text-gray-700">Tempel Teks</label>
                         <textarea id="text_paste" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Tempelkan teks referensi di sini..."></textarea>
                    </div>

                    <div>
                        <label for="file_upload" class="block text-sm font-medium text-gray-700">Unggah File (.pdf, .docx, .pptx, .xlsx, .epub)</label>
                        <input type="file" id="file_upload" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.epub">
                    </div>

                    <div>
                        <button id="generate-btn" class="w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Buat Artikel
                        </button>
                    </div>
                </div>

                <div id="loading" class="mt-8 text-center" style="display: none;">
                    <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-2 text-gray-600">AI sedang melakukan riset dan menulis artikel untuk Anda... Ini mungkin memerlukan waktu beberapa saat.</p>
                </div>

                <div id="output-container" class="mt-8" style="display: none;">
                    <!-- Editor Controls -->
                     <div id="editor-controls" class="flex items-center justify-between p-2 bg-gray-100 rounded-t-lg space-x-2 border-b border-gray-300 flex-wrap">
                        <div class="flex items-center space-x-1 flex-wrap">
                            <button class="editor-btn" onclick="formatDoc('bold')" title="Bold" disabled><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.44 14.38a.5.5 0 00.56.02c.8-.53 1.34-1.42 1.34-2.4 0-1.63-1.03-2.73-2.84-2.73H6.5v5.12h2.94zm-1.1-3.72h1.1c.92 0 1.44.52 1.44 1.28 0 .8-.52 1.32-1.44 1.32H8.34v-2.6zm6.16-5.16c-2.1 0-3.5 1.57-3.5 3.82 0 1.5.78 2.6 2.05 3.26a3.59 3.59 0 01-1.89.56H6.5a.5.5 0 00-.5.5v.63a.5.5 0 00.5.5H11c2.8 0 4.5-1.78 4.5-4.24 0-2.3-1.7-4.04-4-4.04z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('italic')" title="Italic" disabled><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M7.75 4.5a.5.5 0 000 1h1.36l-1.88 8H6a.5.5 0 000 1h4a.5.5 0 000-1H8.64l1.88-8H11.5a.5.5 0 000-1h-4z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('underline')" title="Underline" disabled><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M6.5 4.5a.5.5 0 000 1h7a.5.5 0 000-1h-7zM5 14.5a.5.5 0 00.5.5h9a.5.5 0 000-1h-9a.5.5 0 00-.5.5zM10 12.5c-2.48 0-4.5-2.02-4.5-4.5V5.75a.5.5 0 011 0V8c0 1.93 1.57 3.5 3.5 3.5s3.5-1.57 3.5-3.5V5.75a.5.5 0 011 0V8c0 2.48-2.02 4.5-4.5 4.5z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('insertUnorderedList')" title="Bullet List" disabled><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 6a1 1 0 11-2 0 1 1 0 012 0zm0 4a1 1 0 11-2 0 1 1 0 012 0zm0 4a1 1 0 11-2 0 1 1 0 012 0zm4-8a.5.5 0 01.5.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5z" clip-rule="evenodd"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('insertOrderedList')" title="Numbered List" disabled><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M4.5 6a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zM2.854 5.146a.5.5 0 010 .708l-1 1a.5.5 0 01-.708 0l-1-1a.5.5 0 01.708-.708L1.5 5.793l.646-.647a.5.5 0 01.708 0zm0 4a.5.5 0 010 .708l-1 1a.5.5 0 01-.708 0l-1-1a.5.5 0 01.708-.708L1.5 9.793l.646-.647a.5.5 0 01.708 0zm0 4a.5.5 0 010 .708l-1 1a.5.5 0 01-.708 0l-1-1a.5.5 0 11.708-.708L1.5 13.793l.646-.647a.5.5 0 01.708 0z"></path></svg></button>
                        </div>
                        <div class="flex items-center space-x-2">
                             <div class="relative">
                                <button id="copy-btn" class="py-2 px-3 text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">Salin</button>
                                <div id="copy-options" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-md shadow-lg z-10 border">
                                    <a href="#" id="copy-text" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Salin sebagai Teks Biasa</a>
                                    <a href="#" id="copy-html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Salin sebagai Rich Text</a>
                                </div>
                            </div>
                            <button id="edit-btn" class="py-2 px-3 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">Edit Artikel</button>
                        </div>
                    </div>
                    <div id="article-output" class="prose bg-white p-6 rounded-b-lg border-t-0"></div>
                </div>


            </div>

            <!-- Panduan SEO Tab -->
            <div id="content-panduan" class="tab-content p-6 md:p-8 prose fade-in">
                <h2>Panduan Membuat Konten Web SEO-Friendly</h2>
                <p>Berikut adalah panduan detail berdasarkan dokumen Google untuk membuat konten yang bermanfaat, andal, dan mengutamakan pengguna, yang merupakan kunci utama SEO.</p>
                <h3>1. Fokus pada Konten yang Bermanfaat dan Mengutamakan Pengguna</h3>
                <p>Google memberi penghargaan pada konten yang dibuat untuk manusia, bukan untuk mesin pencari. Tanyakan pada diri Anda:</p>
                <ul>
                    <li>Apakah audiens target Anda akan merasa konten ini bermanfaat jika mereka menemukannya langsung?</li>
                    <li>Apakah konten Anda menunjukkan keahlian dan pengetahuan mendalam (misalnya, keahlian yang didapat dari pengalaman nyata menggunakan produk/layanan atau mengunjungi suatu tempat)?</li>
                    <li>Apakah situs Anda memiliki tujuan atau fokus utama?</li>
                    <li>Setelah membaca konten Anda, apakah pembaca akan merasa telah belajar cukup banyak tentang suatu topik untuk membantu mencapai tujuan mereka?</li>
                    <li>Apakah pembaca akan merasa mendapatkan pengalaman yang memuaskan?</li>
                </ul>
                <h3>2. Tunjukkan Pengalaman, Keahlian, Otoritas, dan Kepercayaan (E-E-A-T)</h3>
                <p>E-E-A-T (Experience, Expertise, Authoritativeness, Trust) adalah faktor krusial, terutama untuk topik "Your Money or Your Life" (YMYL) yang dapat memengaruhi kesehatan, keuangan, atau keselamatan seseorang.</p>
                <ul>
                    <li><strong>Pengalaman (Experience):</strong> Tunjukkan bahwa konten dibuat oleh seseorang dengan pengalaman langsung. Misalnya, ulasan produk dari orang yang benar-benar telah menggunakannya.</li>
                    <li><strong>Keahlian (Expertise):</strong> Konten harus dibuat oleh seseorang yang memiliki pengetahuan atau keterampilan yang diperlukan tentang topik tersebut.</li>
                    <li><strong>Otoritas (Authoritativeness):</strong> Jadikan situs Anda atau pembuat konten sebagai sumber utama untuk topik tersebut. Informasi "Tentang Kami" yang jelas dan profil penulis membantu membangun otoritas.</li>
                    <li><strong>Kepercayaan (Trust):</strong> Pengguna harus merasa aman dan percaya pada situs Anda. Ini mencakup informasi kontak yang jelas, keamanan situs (HTTPS), dan ulasan pelanggan yang jujur.</li>
                </ul>
                <h3>3. Hindari Membuat Konten untuk Mesin Pencari Terlebih Dahulu</h3>
                <p>Praktik yang harus dihindari:</p>
                <ul>
                    <li>Membuat konten terutama untuk menarik kunjungan dari mesin pencari.</li>
                    <li>Memproduksi banyak konten tentang berbagai topik dengan harapan beberapa di antaranya akan berkinerja baik di hasil penelusuran.</li>
                    <li>Menggunakan otomatisasi ekstensif (termasuk AI) untuk menghasilkan konten tentang banyak topik.</li>
                    <li>Terlalu banyak meringkas apa yang telah dikatakan orang lain tanpa menambahkan nilai baru.</li>
                    <li>Menulis tentang suatu topik hanya karena sedang tren, bukan karena Anda akan menulisnya untuk audiens Anda.</li>
                    <li>Membuat pembaca merasa perlu mencari lagi untuk mendapatkan informasi yang lebih baik dari sumber lain.</li>
                </ul>
                 <h3>4. Siapa, Bagaimana, dan Mengapa</h3>
                <p>Transparansi adalah kunci. Pengguna lebih mempercayai konten jika mereka tahu siapa yang menulisnya, bagaimana konten itu dibuat, dan mengapa mereka harus mempercayai Anda.</p>
                <ul>
                    <li><strong>Siapa (Who):</strong> Jelaskan siapa yang menulis konten tersebut. Sertakan halaman penulis atau bagian "Tentang Kami" yang jelas.</li>
                    <li><strong>Bagaimana (How):</strong> Jelaskan bagaimana konten dibuat. Misalnya, untuk ulasan produk, jelaskan proses pengujiannya. Untuk konten berita, jelaskan proses pengecekan faktanya.</li>
                    <li><strong>Mengapa (Why):</strong> Jelaskan mengapa Anda adalah sumber yang tepat. Apa tujuan situs Anda? Apa misi Anda? Ini membantu membangun kepercayaan dan menunjukkan fokus utama situs Anda.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            const tabs = ['generator', 'panduan'];
            tabs.forEach(tab => {
                const content = document.getElementById(`content-${tab}`);
                const button = document.getElementById(`tab-${tab}`);
                if (tab === tabName) {
                    content.classList.add('active');
                    button.classList.add('text-indigo-600', 'border-indigo-500');
                    button.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                } else {
                    content.classList.remove('active');
                    button.classList.remove('text-indigo-600', 'border-indigo-500');
                    button.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                }
            });
        }

        const generateBtn = document.getElementById('generate-btn');
        const topicInput = document.getElementById('topic');
        const keywordsInput = document.getElementById('keywords');
        const articleOutput = document.getElementById('article-output');
        const loadingDiv = document.getElementById('loading');
        const outputContainer = document.getElementById('output-container');
        
        const websiteUrlInput = document.getElementById('url_website');
        const youtubeUrlInput = document.getElementById('url_youtube');
        const textPasteInput = document.getElementById('text_paste');
        const fileUploadInput = document.getElementById('file_upload');

        const editBtn = document.getElementById('edit-btn');
        const editorControls = document.getElementById('editor-controls');
        const copyBtn = document.getElementById('copy-btn');
        const copyOptions = document.getElementById('copy-options');

        generateBtn.addEventListener('click', async () => {
            const topic = topicInput.value;
            const keywords = keywordsInput.value;
            const references = {
                website: websiteUrlInput.value,
                youtube: youtubeUrlInput.value,
                text: textPasteInput.value,
                files: fileUploadInput.files
            };

            if (!topic.trim()) {
                outputContainer.style.display = 'block';
                articleOutput.innerHTML = `<p class="text-red-500">Silakan masukkan topik artikel.</p>`;
                return;
            }

            loadingDiv.style.display = 'block';
            outputContainer.style.display = 'none';
            articleOutput.innerHTML = '';
            
            const systemPrompt = `Anda adalah seorang penulis konten ahli, spesialis SEO, dan pakar berpengalaman puluhan tahun di bidang yang relevan dengan topik yang diberikan. Tugas Anda adalah menulis artikel blog yang komprehensif, mendalam, dan sangat informatif dengan minimal 1500 kata.

Aturan Penting:
1.  **Grounded in Reality:** Gunakan kemampuan pencarian Google Anda untuk menemukan dan mensintesis informasi dari sumber-sumber yang paling kredibel di internet. Jangan membuat informasi.
2.  **Integrasikan Referensi Pengguna:** Jika pengguna memberikan URL, teks, atau file, anggap itu sebagai sumber informasi utama. Prioritaskan dan integrasikan wawasan dari sumber-sumber ini ke dalam artikel Anda.
3.  **Struktur SEO-Friendly:** Artikel harus memiliki struktur yang jelas dengan judul utama (H1), beberapa subjudul (H2), dan jika perlu sub-subjudul (H3). Gunakan paragraf yang ringkas, daftar berpoin (bullet points), dan cetak tebal untuk meningkatkan keterbacaan. JANGAN gunakan format '####' atau lebih dalam.
4.  **Terapkan E-E-A-T:** Tulis dengan nada yang menunjukkan Pengalaman (Experience), Keahlian (Expertise), Otoritas (Authoritativeness), dan Kepercayaan (Trust). Tunjukkan pemahaman mendalam tentang nuansa topik.
5.  **Gunakan Kata Kunci:** Integrasikan kata kunci yang diberikan pengguna secara alami di seluruh artikel, termasuk dalam judul, subjudul, dan isi paragraf.
6.  **Struktur Artikel Spesifik:** Hasilkan artikel dengan urutan sebagai berikut:
    a.  **Resume Artikel:** Di paling atas, buat ringkasan singkat (maksimal 100 kata) dari keseluruhan artikel. Beri judul '## Resume Artikel'.
    b.  **Daftar Isi:** Setelah resume, buat daftar isi sederhana. Beri judul '## Daftar Isi' dan Cukup tulis placeholder '[Daftar Isi]'. Skrip akan mengisinya secara otomatis.
    c.  **Isi Artikel:** Bagian utama artikel Anda dengan struktur H1, H2, H3. Pastikan ada paragraf pembuka setelah judul utama (H1) dan sebelum subjudul (H2) pertama.
7.  **Panjang Artikel:** Pastikan artikel akhir memiliki panjang minimal 1500 kata.
8.  **Format Output:** Hasilkan artikel dalam format Markdown yang bersih. Gunakan dua baris baru di antara setiap elemen (paragraf, judul, daftar) untuk parsing yang lebih mudah.`;

            let userQuery = `Topik Artikel: "${topic}"\nKata Kunci: "${keywords}"\n\n`;
            if (references.website) userQuery += `Mohon rujuk konten dari URL website ini: ${references.website}\n`;
            if (references.youtube) userQuery += `Mohon rujuk konten dari video YouTube ini: ${references.youtube}\n`;
            if (references.text) userQuery += `Mohon rujuk teks yang ditempel berikut ini:\n---\n${references.text}\n---\n`;
            if (references.files.length > 0) userQuery += `Saya juga telah mengunggah ${references.files.length} file sebagai referensi tambahan. Harap pertimbangkan informasi dari file-file ini dalam tulisan Anda.\n`;
            
            userQuery += `\nSekarang, tulis artikel blog yang komprehensif (minimal 1500 kata) berdasarkan instruksi di atas.`;

            try {
                const { text: articleMarkdown, sources } = await callGeminiAPI(systemPrompt, userQuery);
                let finalMarkdown = articleMarkdown;
                
                if (sources && sources.length > 0) {
                    finalMarkdown += `\n\n## Referensi\n`;
                    sources.forEach((source) => {
                       if(source.uri) finalMarkdown += `* [${source.title}](${source.uri})\n`;
                    });
                }
                
                articleOutput.innerHTML = processMarkdownToHtml(finalMarkdown);
                outputContainer.style.display = 'block';
                editorControls.classList.remove('hidden');
                editorControls.classList.add('flex');

            } catch (error) {
                console.error("Error generating article:", error);
                outputContainer.style.display = 'block';
                articleOutput.innerHTML = `<p class="text-red-500">Maaf, terjadi kesalahan saat membuat artikel. Silakan coba lagi. Error: ${error.message}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        async function callGeminiAPI(systemPrompt, userQuery) {
            const apiKey = ""; // Disediakan oleh environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                systemInstruction: { parts: [{ text: systemPrompt }] },
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
            };
            
            let response;
            let retries = 3;
            let delay = 1000;

            for (let i = 0; i < retries; i++) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            let sources = [];
                            const groundingMetadata = candidate.groundingMetadata;
                            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                sources = groundingMetadata.groundingAttributions
                                    .map(attr => ({ uri: attr.web?.uri, title: attr.web?.title }))
                                    .filter(source => source.uri && source.title);
                            }
                            return { text, sources };
                        } else {
                            throw new Error("Struktur respons API tidak valid atau konten kosong.");
                        }
                    } else if (response.status === 429 || response.status >= 500) {
                        if (i < retries - 1) { await new Promise(res => setTimeout(res, delay)); delay *= 2; continue; }
                    }
                    throw new Error(`API request failed with status ${response.status}: ${response.statusText}`);
                } catch (error) {
                    if (i < retries - 1) { await new Promise(res => setTimeout(res, delay)); delay *= 2; continue; }
                    throw error;
                }
            }
             throw new Error("Gagal mendapatkan respons dari API setelah beberapa kali percobaan.");
        }
        
        function processMarkdownToHtml(markdown) {
            if (!markdown) return '';
            
            let tocItems = [];
            let sectionCounter = 0;

            let processedMarkdown = markdown.replace(/^## (?!Resume Artikel|Daftar Isi|Referensi)(.*$)/gmi, (match, title) => {
                sectionCounter++;
                const id = `section-${sectionCounter}`;
                const cleanTitle = title.trim();
                tocItems.push({ title: cleanTitle, id: id });
                return `<h2 id="${id}">${cleanTitle}</h2>`;
            });
            
            let tocHtml = tocItems.length > 0 ? '<ul>' : '';
            tocItems.forEach(item => {
                tocHtml += `<li><a href="#${item.id}" class="text-indigo-600 hover:underline">${item.title}</a></li>`;
            });
            tocHtml += tocItems.length > 0 ? '</ul>' : '';
            
            processedMarkdown = processedMarkdown.replace('## Daftar Isi\n\n[Daftar Isi]', `<h2>Daftar Isi</h2>\n\n${tocHtml}`);
            processedMarkdown = processedMarkdown.replace('## Daftar Isi\n[Daftar Isi]', `<h2>Daftar Isi</h2>\n\n${tocHtml}`);
            
            return simpleMarkdownToHtml(processedMarkdown);
        }

       function simpleMarkdownToHtml(markdown) {
            if (!markdown) return '';

            const lines = markdown.split('\n');
            let html = '';
            let inList = null; // null, 'ul', 'ol'

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                // Close list if line is empty or not a list item
                if (inList && (!line.startsWith('* ') && !line.match(/^\d+\.\s/))) {
                    html += (inList === 'ul' ? '</ul>' : '</ol>') + '\n';
                    inList = null;
                }

                // Headers
                if (line.startsWith('<h2')) { html += line + '\n'; }
                else if (line.startsWith('## ')) { html += `<h2>${applyInlineFormatting(line.substring(3))}</h2>\n`; }
                else if (line.startsWith('### ')) { html += `<h3>${applyInlineFormatting(line.substring(4))}</h3>\n`; }
                else if (line.startsWith('# ')) { html += `<h1>${applyInlineFormatting(line.substring(2))}</h1>\n`; }
                
                // Unordered list
                else if (line.startsWith('* ')) {
                    if (inList !== 'ul') { html += '<ul>\n'; inList = 'ul'; }
                    html += `<li>${applyInlineFormatting(line.substring(2))}</li>\n`;
                }
                // Ordered list
                else if (line.match(/^\d+\.\s/)) {
                    if (inList !== 'ol') { html += '<ol>\n'; inList = 'ol'; }
                    html += `<li>${applyInlineFormatting(line.replace(/^\d+\.\s/, ''))}</li>\n`;
                }
                // Paragraph
                else if (line.trim() !== '') {
                     html += `<p>${applyInlineFormatting(line)}</p>\n`;
                }
            }

            // Close any open list at the end
            if (inList) {
                html += (inList === 'ul' ? '</ul>' : '</ol>') + '\n';
            }

            return html.replace('<h2>Daftar Isi</h2>\n\n<ul>', '<h2>Daftar Isi</h2><ul>');
        }


        function applyInlineFormatting(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
        }

        // --- Editor and Copy Functionality ---

        editBtn.addEventListener('click', () => {
            const isEditable = articleOutput.isContentEditable;
            const toolbarButtons = editorControls.querySelectorAll('button.editor-btn');
            if (isEditable) {
                articleOutput.contentEditable = 'false';
                editBtn.textContent = 'Edit Artikel';
                articleOutput.classList.remove('border-2', 'border-indigo-300', 'p-6');
                toolbarButtons.forEach(btn => btn.disabled = true);
            } else {
                articleOutput.contentEditable = 'true';
                editBtn.textContent = 'Selesai';
                articleOutput.classList.add('border-2', 'border-indigo-300', 'p-6');
                toolbarButtons.forEach(btn => btn.disabled = false);
                articleOutput.focus();
            }
        });

        function formatDoc(command, value = null) {
            document.execCommand(command, false, value);
            articleOutput.focus();
        }

        copyBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            copyOptions.classList.toggle('hidden');
        });

        document.addEventListener('click', (e) => {
            if (!copyOptions.classList.contains('hidden') && !copyBtn.contains(e.target)) {
                copyOptions.classList.add('hidden');
            }
        });

        document.getElementById('copy-text').addEventListener('click', (e) => {
            e.preventDefault();
            copyToClipboard(articleOutput.innerText, 'Teks Biasa');
        });

        document.getElementById('copy-html').addEventListener('click', (e) => {
            e.preventDefault();
            copyRichTextToClipboard();
        });

        function copyToClipboard(text, type) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = `${type} disalin!`;
                copyOptions.classList.add('hidden');
                setTimeout(() => {
                    copyBtn.textContent = 'Salin';
                }, 2000);
            }).catch(err => {
                console.error('Gagal menyalin teks: ', err);
                alert('Gagal menyalin.');
            });
        }
        
        function copyRichTextToClipboard() {
            const content = articleOutput.innerHTML;
            const blob = new Blob([content], {type: 'text/html'});
            const clipboardItem = new ClipboardItem({'text/html': blob});

            navigator.clipboard.write([clipboardItem]).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = `Rich Text disalin!`;
                copyOptions.classList.add('hidden');
                setTimeout(() => {
                    copyBtn.textContent = 'Salin';
                }, 2000);
            }).catch(err => {
                console.error('Gagal menyalin rich text: ', err);
                // Fallback for older browsers
                copyToClipboard(content, 'HTML');
            });
        }

    </script>
</body>
</html>

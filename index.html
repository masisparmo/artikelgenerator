<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Artikel SEO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .prose {
            max-width: none;
        }
        .prose h1 {
            font-size: 1.875rem; /* 30px */
            font-weight: 700;
            margin-bottom: 0.5em;
        }
        .prose h2 {
            font-size: 1.5em;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.3em;
        }
        .prose h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin-top: 1.2em;
            margin-bottom: 0.4em;
        }
        .prose h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 1em;
            margin-bottom: 0.3em;
        }
        .prose p, .prose ul, .prose ol {
            margin-bottom: 1em;
            line-height: 1.6;
        }
        .prose ul, .prose ol {
            padding-left: 1.5em;
        }
        .prose li {
            margin-bottom: 0.5em;
        }
        .prose strong {
            font-weight: 600;
        }
        .prose em {
            font-style: italic;
        }
        .prose a {
            color: #4f46e5;
            text-decoration: none;
        }
        .prose a:hover {
            text-decoration: underline;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Styling for editor toolbar */
        .editor-btn {
             @apply p-2 rounded enabled:hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-1 focus:ring-indigo-400 text-gray-600;
        }
        .editor-select {
             @apply text-sm px-2 py-1.5 rounded bg-transparent hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-1 focus:ring-indigo-400 border-0;
        }
        #article-output[contenteditable="true"] {
            @apply border-2 border-indigo-300 p-4 rounded-b-md focus:outline-none -mt-px;
        }
        .toolbar-group {
            @apply flex items-center border-r border-gray-300 px-1;
        }
        .toolbar-group:last-child {
            @apply border-r-0;
        }
        #api-modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Loading Modal -->
    <div id="loading-modal-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 text-center">
            <svg class="animate-spin h-10 w-10 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-gray-700 font-medium">AI sedang memproses permintaan Anda...</p>
            <p class="text-sm text-gray-500">Ini mungkin memerlukan waktu beberapa saat.</p>
        </div>
    </div>

    <!-- API Key Modal -->
    <div id="api-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-lg w-full transform transition-all" id="api-modal-content">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Masukkan Kunci API Gemini Anda</h2>
            <p class="text-gray-600 mb-6">Aplikasi ini memerlukan Kunci API Google Gemini untuk berfungsi. Kunci Anda akan disimpan dengan aman di browser Anda dan tidak akan dibagikan.</p>
            
            <input type="password" id="api-key-input" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4 bg-blue-50" placeholder="AIza...">
            <button id="save-api-key" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-medium uppercase">
                Simpan dan Lanjutkan
            </button>
            <p id="api-key-error" class="text-red-500 text-sm mt-2 hidden">Kunci API tidak boleh kosong.</p>

            <div class="mt-8">
                <details class="bg-gray-50 rounded-md p-4">
                    <summary class="font-medium text-gray-700 cursor-pointer hover:text-indigo-600 uppercase">
                        Bagaimana cara mendapatkan Kunci API Gemini gratis?
                    </summary>
                    <div class="mt-4 text-sm text-gray-600 space-y-3">
                        <p>Anda bisa mendapatkan Kunci API secara gratis dari Google AI Studio. Berikut langkah-langkahnya:</p>
                        <ol class="list-decimal list-inside space-y-2">
                            <li>Buka <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 font-medium hover:underline">Google AI Studio</a>.</li>
                            <li>Masuk dengan Akun Google Anda.</li>
                            <li>Klik tombol "<strong>Create API key</strong>".</li>
                            <li>Pilih proyek yang ada atau buat proyek Google Cloud baru (ini gratis).</li>
                            <li>Kunci API Anda akan dibuat. Salin (copy) seluruh kunci tersebut.</li>
                            <li>Tempel (paste) kunci yang sudah disalin ke kolom input di atas dan klik simpan.</li>
                        </ol>
                    </div>
                </details>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
            <h3 class="text-lg font-medium text-gray-900 uppercase">Konfirmasi Hapus</h3>
            <p class="mt-2 text-sm text-gray-500">Apakah Anda yakin ingin menghapus artikel ini? Tindakan ini tidak dapat diurungkan.</p>
            <div class="mt-4 flex justify-end space-x-2">
                <button id="cancel-delete-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 uppercase">Batal</button>
                <button id="confirm-delete-btn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 uppercase">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Re-Write Options Modal -->
    <div id="rewrite-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full">
            <h3 class="text-lg font-medium text-gray-900 uppercase mb-4">Opsi Tulis Ulang</h3>

            <div class="space-y-4">
                <div>
                    <label for="rewrite-style" class="block text-sm font-medium text-gray-700">Gaya Penulisan</label>
                    <select id="rewrite-style" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50">
                        <option>Gaya Penulisan Awam</option>
                        <option>Gaya Penulisan Semi Formal</option>
                        <option>Gaya Penulisan Casual</option>
                    </select>
                </div>
                <div>
                    <label for="rewrite-extra-prompt" class="block text-sm font-medium text-gray-700">Penambahan Pembahasan</label>
                    <textarea id="rewrite-extra-prompt" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="Masukkan topik atau poin tambahan untuk dibahas dalam artikel yang ditulis ulang..."></textarea>
                </div>
            </div>

            <div class="mt-6 flex justify-end space-x-2">
                <button id="cancel-rewrite-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 uppercase">BATAL</button>
                <button id="confirm-rewrite-btn" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 uppercase">OK</button>
            </div>
        </div>
    </div>

    <!-- Edit Idea Modal -->
    <div id="edit-idea-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full">
            <h3 class="text-lg font-medium text-gray-900 uppercase mb-4">Edit Ide</h3>
            <input type="hidden" id="edit-idea-id">
            <textarea id="edit-idea-text" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50"></textarea>
            <div class="mt-4 flex justify-end space-x-2">
                <button id="cancel-edit-idea-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 uppercase">Batal</button>
                <button id="confirm-edit-idea-btn" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 uppercase">Simpan</button>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Generator Artikel SEO Friendly</h1>
            <p class="mt-2 text-gray-600">Buat, edit, dan salin konten berkualitas tinggi yang disukai Google dan pembaca Anda.</p>
        </header>

        <div class="bg-white rounded-lg shadow-lg">
            <!-- Tab Buttons -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex" aria-label="Tabs">
                    <button id="tab-generator" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-indigo-600 border-indigo-500 uppercase" onclick="switchTab('generator')">
                        Generator Artikel
                    </button>
                    <button id="tab-panduan" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 uppercase" onclick="switchTab('panduan')">
                        Panduan SEO
                    </button>
                </nav>
            </div>

            <!-- Generator Artikel Tab -->
            <div id="content-generator" class="tab-content active p-6 md:p-8 fade-in">
                
                <div class="space-y-6">
                    <div>
                        <label for="topic" class="block text-sm font-medium text-gray-700">Topik Artikel</label>
                        <input type="text" id="topic" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="Contoh: Manfaat teh hijau untuk kesehatan">
                    </div>
                    <div class="flex justify-end -mt-2 mb-2">
                        <button id="generate-ideas-btn" class="px-3 py-1 text-xs font-medium text-white bg-indigo-500 rounded-md hover:bg-indigo-600 uppercase">GENERATE IDE</button>
                    </div>
                    <div id="idea-suggestion-container" class="hidden space-y-2 mb-4">
                        <!-- Generated ideas will be injected here -->
                    </div>
                    <!-- Idea Database -->
                    <div id="idea-db-container" class="hidden mt-4">
                         <h3 class="text-lg font-medium text-gray-800 border-b pb-2 mb-3">Database Topik Artikel</h3>
                         <div id="idea-list" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                             <!-- Saved ideas will be listed here -->
                         </div>
                    </div>
                    <div>
                        <label for="keywords" class="block text-sm font-medium text-gray-700">Kata Kunci (pisahkan dengan koma)</label>
                        <input type="text" id="keywords" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="Contoh: teh hijau, antioksidan, kesehatan jantung">
                    </div>
                    <div class="flex justify-end -mt-2 mb-2">
                        <button id="generate-keywords-btn" class="px-3 py-1 text-xs font-medium text-white bg-indigo-500 rounded-md hover:bg-indigo-600 uppercase">GENERATE KEYWORD</button>
                    </div>

                    <h3 class="text-lg font-medium text-gray-800 border-t pt-6">Sumber Referensi (Opsional)</h3>

                    <div>
                        <label for="url_website" class="block text-sm font-medium text-gray-700">URL Website</label>
                        <input type="url" id="url_website" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="https://contoh-website.com/artikel">
                    </div>

                    <div>
                        <label for="url_youtube" class="block text-sm font-medium text-gray-700">URL YouTube</label>
                        <input type="url" id="url_youtube" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="https://www.youtube.com/watch?v=...">
                    </div>

                    <div>
                         <label for="text_paste" class="block text-sm font-medium text-gray-700">Tempel Teks</label>
                         <textarea id="text_paste" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="Tempelkan teks referensi di sini..."></textarea>
                    </div>

                    <div>
                        <label for="file_upload" class="block text-sm font-medium text-gray-700">Unggah File (.pdf, .docx, .pptx, .xlsx, .epub)</label>
                        <input type="file" id="file_upload" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 uppercase" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.epub">
                    </div>

                    <div>
                        <button id="generate-btn" class="w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 uppercase">
                            Buat Artikel Baru
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-10">
                    <!-- Article Database -->
                    <div id="article-db-container" class="hidden">
                         <h3 class="text-lg font-medium text-gray-800 border-b pb-2 mb-3">Database Artikel</h3>
                         <div id="article-list" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                             <!-- Saved articles will be listed here -->
                         </div>
                    </div>
                </div>

                <!-- Image Prompt Generator -->
                <div id="image-generator-container" class="mt-10 hidden">
                    <h3 class="text-lg font-medium text-gray-800 border-b pb-2 mb-3">Buat Prompt Gambar Ilustrasi</h3>
                    <div class="grid grid-cols-1 md:grid-cols-1 gap-6 max-w-xl mx-auto">
                        <!-- Controls -->
                        <div class="space-y-4">
                            <div>
                                <label for="image-type" class="block text-sm font-medium text-gray-700">Tipe Gambar</label>
                                <select id="image-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50">
                                    <option>Foto Realistis</option>
                                    <option>Gambar 2D</option>
                                    <option>Gambar 3D</option>
                                    <option>Abstrak</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700">Aspek Rasio Gambar</label>
                                <div id="aspect-ratio-selector" class="mt-1 flex items-center space-x-2 flex-wrap">
                                    <div class="text-center">
                                        <button data-ratio="1:1" class="aspect-btn border-2 border-indigo-500 p-2 rounded-md text-indigo-600">
                                            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" fill="currentColor"></rect></svg>
                                        </button>
                                        <span class="text-xs text-gray-500">1:1</span>
                                    </div>
                                    <div class="text-center">
                                        <button data-ratio="4:3" class="aspect-btn border-2 border-transparent p-2 rounded-md text-gray-400 hover:text-gray-600">
                                            <svg class="w-8 h-6" viewBox="0 0 32 24"><rect x="0" y="0" width="32" height="24" fill="currentColor"></rect></svg>
                                        </button>
                                        <span class="text-xs text-gray-500">4:3</span>
                                    </div>
                                    <div class="text-center">
                                        <button data-ratio="3:4" class="aspect-btn border-2 border-transparent p-2 rounded-md text-gray-400 hover:text-gray-600">
                                            <svg class="w-6 h-8" viewBox="0 0 24 32"><rect x="0" y="0" width="24" height="32" fill="currentColor"></rect></svg>
                                        </button>
                                         <span class="text-xs text-gray-500">3:4</span>
                                    </div>
                                    <div class="text-center">
                                        <button data-ratio="16:9" class="aspect-btn border-2 border-transparent p-2 rounded-md text-gray-400 hover:text-gray-600">
                                            <svg class="w-10 h-6" viewBox="0 0 48 27"><rect x="0" y="0" width="48" height="27" fill="currentColor"></rect></svg>
                                        </button>
                                         <span class="text-xs text-gray-500">16:9</span>
                                    </div>
                                     <div class="text-center">
                                         <button data-ratio="9:16" class="aspect-btn border-2 border-transparent p-2 rounded-md text-gray-400 hover:text-gray-600">
                                            <svg class="w-6 h-10" viewBox="0 0 27 48"><rect x="0" y="0" width="27" height="48" fill="currentColor"></rect></svg>
                                        </button>
                                         <span class="text-xs text-gray-500">9:16</span>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="flex justify-between items-center">
                                    <label for="prompt-text" class="block text-sm font-medium text-gray-700">Prompt (Teks)</label>
                                    <div class="space-x-2">
                                        <button id="copy-prompt-text-btn" class="text-xs text-indigo-600 hover:underline uppercase">SALIN</button>
                                        <button id="to-json-btn" class="text-xs text-indigo-600 hover:underline uppercase">Ubah ke JSON</button>
                                    </div>
                                </div>
                                <textarea id="prompt-text" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-blue-50" placeholder="Jelaskan gambar yang ingin Anda buat..."></textarea>
                            </div>

                            <div>
                                <div class="flex justify-between items-center">
                                    <label for="prompt-json" class="block text-sm font-medium text-gray-700">Prompt (JSON)</label>
                                    <button id="copy-prompt-json-btn" class="text-xs text-indigo-600 hover:underline uppercase">SALIN</button>
                                </div>
                                <textarea id="prompt-json" rows="4" readonly class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm bg-blue-50 cursor-not-allowed" placeholder="Format JSON akan muncul di sini..."></textarea>
                            </div>

                            <div class="flex flex-wrap gap-2">
                                <button id="generate-prompt-btn" class="flex-1 py-2 px-4 text-sm font-medium rounded-md text-white bg-slate-600 hover:bg-slate-700 uppercase">Generate Prompt</button>
                                <button id="refine-prompt-btn" class="flex-1 py-2 px-4 text-sm font-medium rounded-md text-white bg-slate-600 hover:bg-slate-700 uppercase">Sempurnakan Prompt</button>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="output-container" class="mt-8" style="display: none;">
                     <input type="hidden" id="current-article-id">
                    <!-- Editor Controls -->
                     <div id="editor-controls" class="hidden flex items-center p-1 bg-gray-100 rounded-t-lg border-x border-t border-gray-300 flex-wrap gap-y-1">
                        <div class="toolbar-group">
                             <select id="heading-select" class="editor-select" onchange="formatDoc('formatBlock', this.value)" disabled>
                                <option value="p">Paragraf</option>
                                <option value="h1">Heading 1</option>
                                <option value="h2">Heading 2</option>
                                <option value="h3">Heading 3</option>
                            </select>
                        </div>
                        <div class="toolbar-group">
                            <button class="editor-btn" onclick="formatDoc('bold')" title="Bold" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4.25-4H7v14h7.04c2.1 0 3.71-1.7 3.71-3.78 0-1.52-.86-2.82-2.15-3.43zM10 6.5h3c.97 0 1.75.78 1.75 1.75S13.97 10 13 10h-3V6.5zm3.5 8.5H10v-3h3.5c.97 0 1.75.78 1.75 1.75s-.78 1.25-1.75 1.25z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('italic')" title="Italic" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('underline')" title="Underline" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"></path></svg></button>
                        </div>
                        <div class="toolbar-group">
                            <button class="editor-btn" onclick="formatDoc('insertUnorderedList')" title="Bullet List" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('insertOrderedList')" title="Numbered List" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 11.9V11H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"></path></svg></button>
                        </div>
                        <div class="toolbar-group">
                            <button class="editor-btn" onclick="insertLink()" title="Insert Link" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></button>
                        </div>
                        <div class="toolbar-group">
                             <button class="editor-btn" onclick="formatDoc('justifyLeft')" title="Rata Kiri" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('justifyCenter')" title="Rata Tengah" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"></path></svg></button>
                            <button class="editor-btn" onclick="formatDoc('justifyRight')" title="Rata Kanan" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"></path></svg></button>
                        </div>
                        <div class="toolbar-group">
                            <button class="editor-btn" onclick="formatDoc('removeFormat')" title="Hapus Format" disabled><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21 18 19.73 3.55 5.27 3.27 5zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8h2.4L19 5H6z"></path></svg></button>
                        </div>
                        <div class="flex-grow"></div>
                        <div class="flex items-center space-x-2 pl-2">
                             <div class="relative">
                                <button id="copy-btn" class="py-2 px-3 text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 uppercase">Salin</button>
                                <div id="copy-options" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border">
                                    <a href="#" id="copy-text" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 uppercase">Salin sebagai Teks Biasa</a>
                                    <a href="#" id="copy-html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 uppercase">Salin sebagai Rich Text (HTML)</a>
                                </div>
                            </div>
                            <button id="edit-btn" class="py-2 px-3 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 uppercase">Edit Artikel</button>
                        </div>
                    </div>
                    <div id="article-output" class="prose bg-white p-6 rounded-b-lg"></div>
                    <div id="action-buttons" class="mt-4 flex flex-wrap gap-2 justify-end">
                         <button id="rewrite-btn" class="py-2 px-4 text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 uppercase">Re-Write</button>
                         <button id="paraphrase-btn" class="py-2 px-4 text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 uppercase">Parafrase</button>
                         <button id="save-btn" class="py-2 px-4 text-sm font-medium rounded-md text-white bg-sky-600 hover:bg-sky-700 uppercase">Simpan</button>
                    </div>
                </div>


            </div>

            <!-- Panduan SEO Tab -->
            <div id="content-panduan" class="tab-content p-6 md:p-8 prose fade-in">
                 <h2>Panduan Membuat Konten Web SEO-Friendly</h2>
                <p>Berikut adalah panduan detail berdasarkan dokumen Google untuk membuat konten yang bermanfaat, andal, dan mengutamakan pengguna, yang merupakan kunci utama SEO.</p>
                <h3>1. Fokus pada Konten yang Bermanfaat dan Mengutamakan Pengguna</h3>
                <ul><li>Apakah audiens target Anda akan merasa konten ini bermanfaat jika mereka menemukannya langsung?</li><li>Apakah konten Anda menunjukkan keahlian dan pengetahuan mendalam?</li><li>Apakah situs Anda memiliki tujuan atau fokus utama?</li><li>Setelah membaca konten Anda, apakah pembaca akan merasa telah belajar cukup banyak tentang suatu topik untuk membantu mencapai tujuan mereka?</li></ul>
                <h3>2. Tunjukkan Pengalaman, Keahlian, Otoritas, dan Kepercayaan (E-E-A-T)</h3>
                <ul><li><strong>Pengalaman (Experience):</strong> Tunjukkan bahwa konten dibuat oleh seseorang dengan pengalaman langsung.</li><li><strong>Keahlian (Expertise):</strong> Konten harus dibuat oleh seseorang yang memiliki pengetahuan atau keterampilan yang diperlukan.</li><li><strong>Otoritas (Authoritativeness):</strong> Jadikan situs Anda atau pembuat konten sebagai sumber utama untuk topik tersebut.</li><li><strong>Kepercayaan (Trust):</strong> Pengguna harus merasa aman dan percaya pada situs Anda.</li></ul>
                <h3>3. Hindari Membuat Konten untuk Mesin Pencari Terlebih Dahulu</h3>
                <ul><li>Membuat konten terutama untuk menarik kunjungan dari mesin pencari.</li><li>Memproduksi banyak konten tentang berbagai topik dengan harapan beberapa di antaranya akan berkinerja baik.</li><li>Menggunakan otomatisasi ekstensif (AI) untuk menghasilkan konten tentang banyak topik.</li><li>Meringkas apa yang telah dikatakan orang lain tanpa menambahkan nilai baru.</li></ul>
                 <h3>4. Siapa, Bagaimana, dan Mengapa</h3>
                 <p>Transparansi adalah kunci. Pengguna lebih mempercayai konten jika mereka tahu siapa yang menulisnya, bagaimana konten itu dibuat, dan mengapa mereka harus mempercayai Anda.</p>
                 <ul><li><strong>Siapa (Who):</strong> Jelaskan siapa yang menulis konten tersebut.</li><li><strong>Bagaimana (How):</strong> Jelaskan bagaimana konten dibuat.</li><li><strong>Mengapa (Why):</strong> Jelaskan mengapa Anda adalah sumber yang tepat dan apa tujuan situs Anda.</li></ul>
            </div>
        </div>
    </div>

    <script>
        // --- API Key Modal Logic ---
        let userApiKey = '';
        const apiKeyModalOverlay = document.getElementById('api-modal-overlay');
        const saveApiKeyBtn = document.getElementById('save-api-key');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyError = document.getElementById('api-key-error');

        // --- IndexedDB Logic ---
        let db;
        const dbName = "ArticleGeneratorDB";

        function initDB() {
            const request = indexedDB.open(dbName, 1);

            request.onerror = (event) => {
                console.error("Database error:", event.target.errorCode);
            };

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                const articleStore = db.createObjectStore("articles", { keyPath: "id", autoIncrement: true });
                articleStore.createIndex("title", "title", { unique: false });

                const ideaStore = db.createObjectStore("ideas", { keyPath: "id", autoIncrement: true });
                ideaStore.createIndex("idea", "idea", { unique: false });
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                displayArticles();
                displayIdeas();
            };
        }

        window.addEventListener('DOMContentLoaded', () => {
            initDB();
            userApiKey = localStorage.getItem('geminiApiKey');
            if (!userApiKey) {
                apiKeyModalOverlay.classList.remove('hidden');
            }
        });

        saveApiKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('geminiApiKey', key);
                userApiKey = key;
                apiKeyModalOverlay.classList.add('hidden');
                apiKeyError.classList.add('hidden');
            } else {
                apiKeyError.classList.remove('hidden');
            }
        });

        // --- Main App Logic ---
        function switchTab(tabName) {
            const tabs = ['generator', 'panduan'];
            tabs.forEach(tab => {
                const content = document.getElementById(`content-${tab}`);
                const button = document.getElementById(`tab-${tab}`);
                if (tab === tabName) {
                    content.classList.add('active');
                    button.classList.add('text-indigo-600', 'border-indigo-500');
                    button.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                } else {
                    content.classList.remove('active');
                    button.classList.remove('text-indigo-600', 'border-indigo-500');
                    button.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                }
            });
        }

        const generateBtn = document.getElementById('generate-btn');
        const articleOutput = document.getElementById('article-output');
        const loadingModalOverlay = document.getElementById('loading-modal-overlay');
        const outputContainer = document.getElementById('output-container');
        const editBtn = document.getElementById('edit-btn');
        const editorControls = document.getElementById('editor-controls');
        const copyBtn = document.getElementById('copy-btn');
        const copyOptions = document.getElementById('copy-options');
        const currentArticleIdInput = document.getElementById('current-article-id');


        async function handleArticleGeneration(promptModifier = "") {
            if (!userApiKey) {
                apiKeyModalOverlay.classList.remove('hidden');
                alert("Silakan masukkan Kunci API Gemini Anda untuk melanjutkan.");
                return;
            }
            
            let userQuery;
            const systemPrompt = `Anda adalah seorang penulis konten ahli dan spesialis SEO. Tugas Anda adalah memproses teks yang diberikan sesuai instruksi. Gunakan format Markdown yang bersih. Untuk heading, gunakan HANYA format '# Judul H1', '## Judul H2', dan '### Judul H3'. Jangan gunakan format '####' atau heading yang lebih dalam.`;

            if (promptModifier) { // For Re-write or Paraphrase
                const currentContent = articleOutput.innerText;
                if (!currentContent.trim()) {
                    alert("Tidak ada artikel untuk diproses.");
                    return;
                }
                userQuery = `${promptModifier}:\n\n---\n${currentContent}\n---`;
            } else { // For new article generation
                const topic = document.getElementById('topic').value;
                const keywords = document.getElementById('keywords').value;
                if (!topic.trim()) {
                    alert("Silakan masukkan topik artikel.");
                    return;
                }
                userQuery = `Topik Artikel: "${topic}"\nKata Kunci: "${keywords}"\n\n Tulis artikel blog yang komprehensif (minimal 1500 kata). Sertakan '## Resume Artikel', '## Daftar Isi' dengan placeholder '[Daftar Isi]', dan bagian utama artikel.`;
            }

            loadingModalOverlay.classList.remove('hidden');
            outputContainer.style.display = 'none';
            
            try {
                const { text: articleMarkdown, sources } = await callGenerationAPI(systemPrompt, userQuery, 'gemini-2.5-flash', true);
                let finalMarkdown = articleMarkdown;
                
                if (sources && sources.length > 0) {
                    finalMarkdown += `\n\n## Referensi\n`;
                    sources.forEach(source => {
                       if(source.uri) finalMarkdown += `* [${source.title}](${source.uri})\n`;
                    });
                }
                
                currentArticleIdInput.value = ""; // It's a new/modified article, not from DB
                articleOutput.innerHTML = processMarkdownToHtml(finalMarkdown);
                outputContainer.style.display = 'block';
                editorControls.classList.remove('hidden');
                editorControls.classList.add('flex');
                document.getElementById('image-generator-container').classList.remove('hidden');

            } catch (error) {
                console.error("Error processing article:", error);
                outputContainer.style.display = 'block';
                articleOutput.innerHTML = `<p class="text-red-500">Maaf, terjadi kesalahan: ${error.message}</p>`;
            } finally {
                loadingModalOverlay.classList.add('hidden');
            }
        }

        generateBtn.addEventListener('click', () => handleArticleGeneration());

        const rewriteBtn = document.getElementById('rewrite-btn');
        const rewriteModalOverlay = document.getElementById('rewrite-modal-overlay');
        const cancelRewriteBtn = document.getElementById('cancel-rewrite-btn');
        const confirmRewriteBtn = document.getElementById('confirm-rewrite-btn');

        rewriteBtn.addEventListener('click', () => {
            const currentContent = articleOutput.innerText;
            if (!currentContent.trim()) {
                alert("Tidak ada artikel untuk ditulis ulang.");
                return;
            }
            rewriteModalOverlay.classList.remove('hidden');
        });

        cancelRewriteBtn.addEventListener('click', () => {
            rewriteModalOverlay.classList.add('hidden');
        });

        confirmRewriteBtn.addEventListener('click', () => {
            const style = document.getElementById('rewrite-style').value;
            const extraPrompt = document.getElementById('rewrite-extra-prompt').value;

            let prompt = `Tulis ulang artikel berikut dengan '${style}'.`;
            if (extraPrompt.trim()) {
                prompt += `\n\nSertakan juga pembahasan tambahan mengenai: "${extraPrompt}"`;
            }

            handleArticleGeneration(prompt);
            rewriteModalOverlay.classList.add('hidden');
        });

        document.getElementById('paraphrase-btn').addEventListener('click', () => handleArticleGeneration("Parafrasekan artikel berikut kalimat per kalimat. Gunakan sinonim dan ubah struktur kalimat agar unik, namun jangan mengubah makna aslinya."));


        async function callGenerationAPI(systemPrompt, userQuery, model, useSearchTool = false) {
            if (!userApiKey) {
                apiKeyModalOverlay.classList.remove('hidden');
                throw new Error("Silakan masukkan Kunci API Gemini Anda untuk melanjutkan.");
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${userApiKey}`;

            const payload = {
                systemInstruction: { parts: [{ text: systemPrompt }] },
                contents: [{ parts: [{ text: userQuery }] }],
            };

            if (useSearchTool) {
                payload.tools = [{ "google_search": {} }];
            } else {
                payload.generationConfig = { "responseMimeType": "text/plain" };
            }

            let response;
            let retries = 3, delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            let sources = [];
                            if (useSearchTool) {
                                const groundingMetadata = candidate.groundingMetadata;
                                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                    sources = groundingMetadata.groundingAttributions.map(attr => ({ uri: attr.web?.uri, title: attr.web?.title })).filter(s => s.uri && s.title);
                                }
                            }
                            return { text, sources };
                        } else {
                            if (candidate && candidate.finishReason === 'SAFETY') {
                                console.error('API call blocked due to safety settings:', candidate.safetyRatings);
                                throw new Error("Respons diblokir karena alasan keamanan. Coba ubah permintaan Anda.");
                            }
                            console.error("Invalid API response structure:", result);
                            throw new Error("Respons API tidak valid atau kosong.");
                        }
                    } else if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('geminiApiKey');
                        userApiKey = '';
                        apiKeyModalOverlay.classList.remove('hidden');
                        throw new Error("Kunci API tidak valid atau telah dicabut. Silakan masukkan kunci yang baru.");
                    } else if (response.status === 400) {
                        const errorResult = await response.json();
                        console.error('API Error 400:', JSON.stringify(errorResult, null, 2));
                        throw new Error(`Permintaan tidak valid (400): ${errorResult.error?.message || 'Periksa payload permintaan Anda.'}`);
                    } else if (response.status === 429 || response.status >= 500) {
                        console.warn(`API call failed with status ${response.status}. Retrying in ${delay}ms...`);
                        if (i < retries - 1) { await new Promise(res => setTimeout(res, delay)); delay *= 2; continue; }
                    }
                    const errorText = await response.text();
                    throw new Error(`Permintaan API gagal: ${response.status} ${response.statusText}. Detail: ${errorText}`);
                } catch (error) {
                    if (i < retries - 1) {
                        console.warn(`An error occurred: ${error.message}. Retrying in ${delay}ms...`);
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                        continue;
                    }
                    throw error;
                }
            }
            throw new Error("Gagal mendapatkan respons dari API setelah beberapa kali percobaan.");
        }

        // --- Database Functions ---
        document.getElementById('save-btn').addEventListener('click', () => {
            const content = articleOutput.innerHTML;
            const titleElement = articleOutput.querySelector('h1');
            let title = titleElement ? titleElement.innerText : document.getElementById('topic').value.trim();
            if (!title) {
                title = "Artikel Tanpa Judul";
            }
            const id = currentArticleIdInput.value ? parseInt(currentArticleIdInput.value) : null;

            if (!content.trim()) {
                alert("Tidak ada konten untuk disimpan.");
                return;
            }

            const transaction = db.transaction(["articles"], "readwrite");
            const objectStore = transaction.objectStore("articles");
            
            const article = { title, content };
            if (id) {
                article.id = id;
            }

            const request = id ? objectStore.put(article) : objectStore.add(article);

            request.onsuccess = () => {
                alert("Artikel berhasil disimpan!");
                displayArticles();
                if (!id) {
                   currentArticleIdInput.value = request.result;
                }
            };
            request.onerror = (event) => {
                console.error("Gagal menyimpan artikel:", event.target.errorCode);
                alert("Gagal menyimpan artikel.");
            };
        });

        function displayArticles() {
            const articleList = document.getElementById('article-list');
            const dbContainer = document.getElementById('article-db-container');
            articleList.innerHTML = '';

            const objectStore = db.transaction("articles").objectStore("articles");
            const request = objectStore.getAll();
            
            request.onsuccess = (event) => {
                const articles = event.target.result;
                if (articles && articles.length > 0) {
                    dbContainer.classList.remove('hidden');
                    articles.forEach(article => {
                        const item = document.createElement('div');
                        item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded hover:bg-gray-100';
                        item.innerHTML = `
                            <div class="flex items-center space-x-2 flex-grow overflow-hidden">
                                <svg class="w-5 h-5 text-gray-500 hover:text-indigo-600 cursor-pointer flex-shrink-0" data-id="${article.id}" data-action="edit" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></svg>
                                <svg class="w-5 h-5 text-red-400 hover:text-red-600 cursor-pointer flex-shrink-0" data-id="${article.id}" data-action="delete" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
                                <span class="truncate text-sm text-gray-700 ml-2">${article.title}</span>
                            </div>
                        `;
                        articleList.appendChild(item);
                    });
                } else {
                    dbContainer.classList.add('hidden');
                }
            };
        }

        document.getElementById('article-list').addEventListener('click', (e) => {
            const target = e.target.closest('[data-action]');
            if (!target) return;

            const id = parseInt(target.dataset.id);
            const action = target.dataset.action;

            if (action === 'edit') {
                loadArticleForEditing(id);
            } else if (action === 'delete') {
                showDeleteConfirmation(id);
            }
        });

        function loadArticleForEditing(id) {
            const request = db.transaction("articles").objectStore("articles").get(id);
            request.onsuccess = (event) => {
                const article = event.target.result;
                articleOutput.innerHTML = article.content;
                currentArticleIdInput.value = article.id;
                outputContainer.style.display = 'block';
                editorControls.classList.remove('hidden');
                editorControls.classList.add('flex');
                document.getElementById('image-generator-container').classList.remove('hidden');
                window.scrollTo({ top: outputContainer.offsetTop, behavior: 'smooth' });
            };
        }
        
        // Delete Modal Logic
        const deleteModalOverlay = document.getElementById('delete-modal-overlay');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        let articleIdToDelete = null;

        function showDeleteConfirmation(id) {
            articleIdToDelete = id;
            deleteModalOverlay.classList.remove('hidden');
        }

        cancelDeleteBtn.addEventListener('click', () => {
            deleteModalOverlay.classList.add('hidden');
            articleIdToDelete = null;
        });

        confirmDeleteBtn.addEventListener('click', () => {
            if (articleIdToDelete) {
                const request = db.transaction(["articles"], "readwrite").objectStore("articles").delete(articleIdToDelete);
                request.onsuccess = () => {
                    displayArticles();
                };
            }
            deleteModalOverlay.classList.add('hidden');
            articleIdToDelete = null;
        });


        // --- Markdown & Editor Functions ---
        function processMarkdownToHtml(markdown) {
            if (!markdown) return '';
            let tocItems = [];
            let sectionCounter = 0;
            let processedMarkdown = markdown.replace(/^## (?!Resume Artikel|Daftar Isi|Referensi)(.*$)/gmi, (match, title) => {
                sectionCounter++;
                const id = `section-${sectionCounter}`;
                const cleanTitle = title.trim();
                tocItems.push({ title: cleanTitle, id: id });
                return `<h2 id="${id}">${cleanTitle}</h2>`;
            });
            let tocHtml = tocItems.length > 0 ? '<ul>' : '';
            tocItems.forEach(item => { tocHtml += `<li><a href="#${item.id}" class="text-indigo-600 hover:underline">${item.title}</a></li>`; });
            tocHtml += tocItems.length > 0 ? '</ul>' : '';
            processedMarkdown = processedMarkdown.replace(/## Daftar Isi\s*\[Daftar Isi\]/g, `<h2>Daftar Isi</h2>\n\n${tocHtml}`);
            return simpleMarkdownToHtml(processedMarkdown);
        }

       function simpleMarkdownToHtml(markdown) {
            if (!markdown) return '';
            const lines = markdown.split('\n');
            let html = '';
            let inList = null;
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                let isUl = line.trim().startsWith('* ');
                let isOl = line.trim().match(/^\d+\.\s/);
                if (inList && !isUl && !isOl && line.trim() !== '') {
                    html += (inList === 'ul' ? '</ul>' : '</ol>') + '\n';
                    inList = null;
                }
                if (line.startsWith('<h2')) { html += line + '\n'; }
                else if (line.startsWith('#### ')) { html += `<h4>${applyInlineFormatting(line.substring(5))}</h4>\n`; }
                else if (line.startsWith('### ')) { html += `<h3>${applyInlineFormatting(line.substring(4))}</h3>\n`; }
                else if (line.startsWith('## ')) { html += `<h2>${applyInlineFormatting(line.substring(3))}</h2>\n`; }
                else if (line.startsWith('# ')) { html += `<h1>${applyInlineFormatting(line.substring(2))}</h1>\n`; }
                else if (isUl) {
                    if (inList !== 'ul') { html += '<ul>\n'; inList = 'ul'; }
                    html += `<li>${applyInlineFormatting(line.trim().substring(2))}</li>\n`;
                }
                else if (isOl) {
                    if (inList !== 'ol') { html += '<ol>\n'; inList = 'ol'; }
                    html += `<li>${applyInlineFormatting(line.trim().replace(/^\d+\.\s/, ''))}</li>\n`;
                }
                else if (line.trim().startsWith('<ul>')) { html += line; inList = 'ul' }
                else if (line.trim() !== '') { html += `<p>${applyInlineFormatting(line)}</p>\n`; }
            }
            if (inList) { html += (inList === 'ul' ? '</ul>' : '</ol>') + '\n'; }
            return html;
        }

        function applyInlineFormatting(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
        }

        editBtn.addEventListener('click', () => {
            const isEditable = articleOutput.isContentEditable;
            const toolbarElements = editorControls.querySelectorAll('button.editor-btn, select.editor-select');
            if (isEditable) {
                articleOutput.contentEditable = 'false';
                editBtn.textContent = 'Edit Artikel';
                articleOutput.classList.remove('border-2', 'border-indigo-300', 'p-4', 'rounded-b-md', '-mt-px');
                editorControls.classList.add('rounded-b-lg');
                toolbarElements.forEach(el => el.disabled = true);
            } else {
                articleOutput.contentEditable = 'true';
                editBtn.textContent = 'Selesai';
                articleOutput.classList.add('border-2', 'border-indigo-300', 'p-4', 'rounded-b-md', '-mt-px');
                editorControls.classList.remove('rounded-b-lg');
                toolbarElements.forEach(el => el.disabled = false);
                articleOutput.focus();
            }
        });

        function formatDoc(command, value = null) {
            document.execCommand(command, false, value);
            articleOutput.focus();
        }

        function insertLink() {
            const url = prompt("Masukkan URL:", "https://");
            if (url) {
                formatDoc('createLink', url);
            }
        }

        copyBtn.addEventListener('click', (e) => { e.stopPropagation(); copyOptions.classList.toggle('hidden'); });
        document.addEventListener('click', (e) => { if (!copyOptions.classList.contains('hidden') && !copyBtn.contains(e.target)) { copyOptions.classList.add('hidden'); } });
        document.getElementById('copy-text').addEventListener('click', (e) => { e.preventDefault(); copyToClipboard(articleOutput.innerText, 'Teks Biasa'); });
        document.getElementById('copy-html').addEventListener('click', (e) => { e.preventDefault(); copyRichTextToClipboard(); });

        function copyToClipboard(text, type) {
            navigator.clipboard.writeText(text).then(() => { notifyCopySuccess(type); }).catch(err => { console.error('Gagal menyalin: ', err); alert('Gagal menyalin.'); });
        }
        
        function copyRichTextToClipboard() {
            const content = articleOutput.innerHTML;
            const blob = new Blob([content], {type: 'text/html'});
            const clipboardItem = new ClipboardItem({'text/html': blob});
            navigator.clipboard.write([clipboardItem]).then(() => { notifyCopySuccess('Rich Text'); }).catch(err => { console.error('Gagal menyalin rich text: ', err); copyToClipboard(content, 'HTML'); });
        }

        function notifyCopySuccess(type) {
            const originalText = copyBtn.textContent;
            copyBtn.textContent = `${type} disalin!`;
            copyOptions.classList.add('hidden');
            setTimeout(() => { copyBtn.textContent = 'Salin'; }, 2000);
        }

        // --- Image Generator Logic ---
        const imageGeneratorContainer = document.getElementById('image-generator-container');
        const generatePromptBtn = document.getElementById('generate-prompt-btn');
        const refinePromptBtn = document.getElementById('refine-prompt-btn');
        const toJsonBtn = document.getElementById('to-json-btn');
        const copyPromptTextBtn = document.getElementById('copy-prompt-text-btn');
        const copyPromptJsonBtn = document.getElementById('copy-prompt-json-btn');
        const generateIdeasBtn = document.getElementById('generate-ideas-btn');
        const generateKeywordsBtn = document.getElementById('generate-keywords-btn');
        const ideaSuggestionContainer = document.getElementById('idea-suggestion-container');
        const aspectRatioSelector = document.getElementById('aspect-ratio-selector');
        const promptText = document.getElementById('prompt-text');
        const promptJson = document.getElementById('prompt-json');
        let selectedAspectRatio = "1:1"; // Default

        aspectRatioSelector.addEventListener('click', (e) => {
            const button = e.target.closest('.aspect-btn');
            if (button) {
                // Remove border from all buttons
                aspectRatioSelector.querySelectorAll('.aspect-btn').forEach(btn => {
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                    btn.classList.add('border-transparent', 'text-gray-400');
                });
                // Add border to clicked button
                button.classList.add('border-indigo-500', 'text-indigo-600');
                button.classList.remove('border-transparent', 'text-gray-400');
                selectedAspectRatio = button.dataset.ratio;
            }
        });

        generatePromptBtn.addEventListener('click', () => {
            const topic = document.getElementById('topic').value;
            const keywords = document.getElementById('keywords').value;
            if (!topic.trim()) {
                alert("Silakan masukkan topik artikel terlebih dahulu.");
                return;
            }
            promptText.value = `Sebuah gambar ilustrasi untuk artikel tentang "${topic}". Fokus pada kata kunci: ${keywords}.`;
        });

        toJsonBtn.addEventListener('click', () => {
            const imageType = document.getElementById('image-type').value;
            const prompt = promptText.value;
            if (!prompt.trim()) {
                alert("Silakan isi prompt teks terlebih dahulu.");
                return;
            }
            const jsonObject = {
                "prompt": prompt,
                "image_type": imageType,
                "aspect_ratio": selectedAspectRatio
            };
            promptJson.value = JSON.stringify(jsonObject, null, 2);
        });

        refinePromptBtn.addEventListener('click', async () => {
            const currentPrompt = promptText.value;
            if (!currentPrompt.trim()) {
                alert("Silakan isi prompt terlebih dahulu untuk disempurnakan.");
                return;
            }

            loadingModalOverlay.classList.remove('hidden');

            try {
                const systemPrompt = `Anda adalah seorang Prompt Engineer ahli dengan pengalaman puluhan tahun. Peran Anda adalah untuk mengubah prompt sederhana menjadi sebuah mahakarya deskriptif yang siap menghasilkan gambar fotorealistik atau artistik yang menakjubkan.

                Saat Anda menerima prompt dari pengguna, lakukan hal berikut:
                1.  **Analisis Konsep Inti**: Identifikasi subjek utama, lingkungan, dan emosi dari prompt awal.
                2.  **Tambahkan Detail Sinematik**: Jelaskan pencahayaan (misalnya, 'cahaya keemasan sore hari', 'pencahayaan neon remang-remang'), sudut kamera (misalnya, 'sudut rendah', 'close-up dramatis'), dan komposisi.
                3.  **Perkaya Deskripsi**: Gunakan kata-kata yang kuat dan imajinatif untuk mendeskripsikan tekstur, warna, atmosfer, dan detail latar belakang.
                4.  **Tentukan Gaya Artistik**: Jika sesuai, sarankan gaya visual seperti 'gaya lukisan cat minyak impresionistis', 'fotografi potret hyper-realistic', atau 'seni konsep fiksi ilmiah sinematik'.

                Tujuan Anda adalah memberikan prompt yang sangat detail sehingga AI generator gambar dapat menciptakan hasil yang kaya, kompleks, dan sesuai dengan visi yang diperluas. Balas HANYA dengan prompt yang sudah disempurnakan, tanpa kata pengantar atau penjelasan apa pun.`;
                const userQuery = `Sempurnakan prompt ini: "${currentPrompt}"`;

                const { text: refinedPrompt } = await callGenerationAPI(systemPrompt, userQuery, 'gemini-2.5-flash');

                promptText.value = refinedPrompt.trim();

            } catch (error) {
                console.error("Error refining prompt:", error);
                alert(`Gagal menyempurnakan prompt: ${error.message}`);
            } finally {
                loadingModalOverlay.classList.add('hidden');
            }
        });

        copyPromptTextBtn.addEventListener('click', (e) => {
            const btn = e.currentTarget;
            const originalText = btn.textContent;
            if (!promptText.value.trim()) {
                alert("Tidak ada teks untuk disalin.");
                return;
            }
            navigator.clipboard.writeText(promptText.value).then(() => {
                btn.textContent = "Tersalin!";
                setTimeout(() => { btn.textContent = originalText; }, 2000);
            }).catch(err => { console.error('Gagal menyalin: ', err); alert('Gagal menyalin.'); });
        });

        copyPromptJsonBtn.addEventListener('click', (e) => {
            const btn = e.currentTarget;
            const originalText = btn.textContent;
            if (!promptJson.value.trim()) {
                alert("Tidak ada JSON untuk disalin.");
                return;
            }
            navigator.clipboard.writeText(promptJson.value).then(() => {
                btn.textContent = "Tersalin!";
                setTimeout(() => { btn.textContent = originalText; }, 2000);
            }).catch(err => { console.error('Gagal menyalin: ', err); alert('Gagal menyalin.'); });
        });

        generateIdeasBtn.addEventListener('click', async () => {
            const topic = document.getElementById('topic').value;
            if (!topic.trim()) {
                alert("Silakan masukkan topik artikel terlebih dahulu untuk mendapatkan ide.");
                return;
            }

            loadingModalOverlay.classList.remove('hidden');
            ideaSuggestionContainer.innerHTML = '';
            ideaSuggestionContainer.classList.add('hidden');

            try {
                const systemPrompt = "Anda adalah generator ide konten yang kreatif. Berdasarkan topik yang diberikan, hasilkan 5 ide judul artikel blog yang menarik dan SEO-friendly. Setiap ide harus berada di baris baru, diawali dengan '- ' (tanda hubung dan spasi).";
                const userQuery = `Topik: "${topic}"`;

                const { text: ideasText } = await callGenerationAPI(systemPrompt, userQuery, 'gemini-2.5-flash');

                const ideas = ideasText.split('\n').filter(idea => idea.trim().startsWith('- ')).map(idea => idea.trim().substring(2).trim());

                if (ideas.length > 0) {
                    const ideasHtml = ideas.map(idea => `
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded hover:bg-indigo-50 group">
                            <span class="idea-text text-sm text-gray-800 cursor-pointer group-hover:text-indigo-600 flex-grow">${idea}</span>
                            <button class="save-idea-btn ml-2 p-1 rounded-full hover:bg-green-200 opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path d="M7.5 2.5a.5.5 0 00-1 0V5a.5.5 0 001 0V2.5zM10 2.5a.5.5 0 00-1 0V5a.5.5 0 001 0V2.5zM12.5 2.5a.5.5 0 00-1 0V5a.5.5 0 001 0V2.5z"></path><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"></path></svg>
                            </button>
                        </div>
                    `).join('');
                    ideaSuggestionContainer.innerHTML = ideasHtml;
                    ideaSuggestionContainer.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Error generating ideas:", error);
                alert(`Gagal menghasilkan ide: ${error.message}`);
            } finally {
                loadingModalOverlay.classList.add('hidden');
            }
        });

        ideaSuggestionContainer.addEventListener('click', (e) => {
            if (e.target.closest('.save-idea-btn')) {
                const ideaText = e.target.closest('.flex').querySelector('.idea-text').textContent;
                const transaction = db.transaction(["ideas"], "readwrite");
                const objectStore = transaction.objectStore("ideas");
                objectStore.add({ idea: ideaText });
                transaction.oncomplete = () => {
                    displayIdeas();
                };
            } else {
                 const ideaTextEl = e.target.closest('.idea-text');
                if (ideaTextEl) {
                    document.getElementById('topic').value = ideaTextEl.textContent;
                }
            }
        });

        generateKeywordsBtn.addEventListener('click', async () => {
            const topic = document.getElementById('topic').value;
            if (!topic.trim()) {
                alert("Silakan masukkan topik artikel terlebih dahulu untuk mendapatkan kata kunci.");
                return;
            }

            loadingModalOverlay.classList.remove('hidden');

            try {
                const systemPrompt = "Anda adalah seorang spesialis SEO. Berdasarkan topik yang diberikan, hasilkan daftar maksimal 10 kata kunci yang paling relevan. Pisahkan setiap kata kunci dengan koma. Berikan hanya daftar kata kunci, tanpa teks tambahan.";
                const userQuery = `Topik: "${topic}"`;

                const { text: keywordsText } = await callGenerationAPI(systemPrompt, userQuery, 'gemini-2.5-flash');

                document.getElementById('keywords').value = keywordsText.trim();

            } catch (error) {
                console.error("Error generating keywords:", error);
                alert(`Gagal menghasilkan kata kunci: ${error.message}`);
            } finally {
                loadingModalOverlay.classList.add('hidden');
            }
        });

        // --- Idea Database Functions ---
        function displayIdeas() {
            const ideaList = document.getElementById('idea-list');
            const ideaDbContainer = document.getElementById('idea-db-container');
            ideaList.innerHTML = '';

            const transaction = db.transaction("ideas", "readonly");
            const objectStore = transaction.objectStore("ideas");
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const ideas = event.target.result;
                if (ideas && ideas.length > 0) {
                    ideaDbContainer.classList.remove('hidden');
                    ideas.forEach(idea => {
                        const item = document.createElement('div');
                        item.className = 'flex items-center p-2 bg-gray-50 rounded hover:bg-gray-100';
                        item.innerHTML = `
                            <div class="flex-shrink-0 flex items-center space-x-2 mr-3">
                                <svg data-id="${idea.id}" data-action="use" class="w-5 h-5 text-gray-400 hover:text-green-600 cursor-pointer" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                <svg data-id="${idea.id}" data-action="edit" class="w-5 h-5 text-gray-400 hover:text-indigo-600 cursor-pointer" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                                <svg data-id="${idea.id}" data-action="delete" class="w-5 h-5 text-gray-400 hover:text-red-600 cursor-pointer" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                            </div>
                            <span class="flex-grow text-sm text-gray-700">${idea.idea}</span>
                        `;
                        ideaList.appendChild(item);
                    });
                } else {
                    ideaDbContainer.classList.add('hidden');
                }
            };
        }

        document.getElementById('idea-list').addEventListener('click', (e) => {
            const target = e.target.closest('[data-action]');
            if (!target) return;
            const id = parseInt(target.dataset.id);
            const action = target.dataset.action;
            const ideaText = target.closest('.flex').querySelector('span').textContent;

            if (action === 'use') {
                document.getElementById('topic').value = ideaText;
            } else if (action === 'delete') {
                const transaction = db.transaction(["ideas"], "readwrite");
                transaction.objectStore("ideas").delete(id);
                transaction.oncomplete = () => displayIdeas();
            } else if (action === 'edit') {
                document.getElementById('edit-idea-id').value = id;
                document.getElementById('edit-idea-text').value = ideaText;
                document.getElementById('edit-idea-modal-overlay').classList.remove('hidden');
            }
        });

        document.getElementById('cancel-edit-idea-btn').addEventListener('click', () => {
            document.getElementById('edit-idea-modal-overlay').classList.add('hidden');
        });

        document.getElementById('confirm-edit-idea-btn').addEventListener('click', () => {
            const id = parseInt(document.getElementById('edit-idea-id').value);
            const newText = document.getElementById('edit-idea-text').value;
            const transaction = db.transaction(["ideas"], "readwrite");
            const objectStore = transaction.objectStore("ideas");
            const request = objectStore.get(id);
            request.onsuccess = () => {
                const data = request.result;
                data.idea = newText;
                const updateRequest = objectStore.put(data);
                updateRequest.onsuccess = () => {
                    document.getElementById('edit-idea-modal-overlay').classList.add('hidden');
                    displayIdeas();
                };
            };
        });

    </script>
</body>
</html>
